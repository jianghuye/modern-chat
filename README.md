# Modern Chat - 现代化聊天系统

一个基于 PHP + MySQL + HTML 的现代化聊天系统，具有现代化的 UI 设计和丰富的功能。

---

   ### 已部署好的体验网站

  - https://chat.hyacine.com.cn/chat

---
## 功能特性

- 📱 **现代化 UI 设计** - 响应式设计，适配各种设备
- 🔐 **用户认证** - 安全的注册和登录系统
- 👥 **好友管理** - 添加好友、接受请求、查看好友列表
- 💬 **实时聊天** - 发送文本消息和文件
- 📎 **文件传输** - 支持发送小于 150MB（可修改） 的文件
- 🟢 **在线状态** - 显示好友是否在线
- 🔍 **好友搜索** - 快速查找好友
- 📱 **响应式设计** - 适配移动端和桌面端
- 📝 **反馈系统** - 用户可以提交反馈，管理员可以查看和管理反馈
- 🔔 **反馈通知** - 用户提交的反馈被处理后会收到通知
- 👥 **群聊功能** - 支持创建群聊、邀请好友加入群聊
- 📨 **群聊邀请** - 支持邀请好友加入群聊，包含审批流程
- ⏳ **入群申请** - 普通成员邀请的好友需要管理员或群主审批才能入群
- 🔒 **封禁系统** - 管理员可以封禁用户，被封禁用户无法登录和使用系统
- 👨‍💼 **自动添加管理员好友** - 用户注册后自动添加Admin管理员为好友并自动通过，方便管理员沟通和管理
- ⏱️ **会话时长配置** - 支持配置用户会话时长，默认为1小时，可在config.json或管理后台修改
- ⏪ **消息撤回** - 支持撤回2分钟内的消息和文件，撤回后显示撤回提示
- ✏️ **重新编辑** - 撤回消息后可点击"重新编辑"按钮重新编辑消息
- 🗑️ **文件撤回** - 撤回消息时自动删除服务器上的对应文件
- 📱 **移动端支持** - 独立的移动端聊天页面，优化移动端体验
- 👥 **移动端好友管理** - 移动端支持查看好友申请、同意/拒绝好友申请
- 💬 **移动端聊天菜单** - 移动端聊天页面支持好友和群聊的操作菜单
- 👥 **移动端群成员操作** - 移动端群成员列表支持向成员发送好友申请
- 🗑️ **移动端删除好友** - 移动端支持删除好友功能
- 📨 **移动端群聊操作** - 移动端支持查看群成员和退出群聊功能

## 技术栈

- **前端**: HTML5, CSS3, JavaScript
- **后端**: PHP 7.4+
- **数据库**: MySQL 5.7+
- **数据库驱动**: PDO
## config.json 配置文件

在config目录下，您需要修改一个 `config.json` 文件，用于存储聊天系统的配置信息和其他配置。以下是一个示例配置文件：

```json
{
    "Create_a_group_chat_for_all_members": true,
    "Restrict_registration": true, 
    "Restrict_registration_ip": 3, 
    "ban_system": true, 
    "user_name_max": 12,
    "upload_files_max": 150,
    "Session_Duration": 1,
    "email_verify": true,
    "email_verify_api": "https:\/\/api.nbhao.org\/v1\/email\/verify",
    "email_verify_api_Request": "POST",
    "email_verify_api_Verify_parameters": "message.result"
}
```
`Create_a_group_chat_for_all_members`: 你希望用户注册后自动创建一个群聊，群聊名称为所有用户的用户名拼接，例如：user1user2user3
`Restrict_registration`: 是否限制注册（如果配置了这个必须配置下面的Restrict_registration_ip的数量）
`Restrict_registration_ip`: 你希望一个IP地址最多注册几个账号
`user_name_max`: 你希望最大设置的用户名长度
`ban_system`: 是否启用封禁系统
`upload_files_max`: 你希望用户最大可发送的文件大小（MB）
`Session_Duration`: 用户会话时长（小时），默认1小时
`email_verify`: 是否启用邮箱验证
`email_verify_api`: 邮箱验证 API 地址
`email_verify_api_Request`: 邮箱验证 API 请求方法（GET 或 POST）
`email_verify_api_Verify_parameters`: 邮箱验证 API 返回结果参数名（例如："message.result"）

请根据您的实际配置修改这些值。

## 安装步骤

### 1. 克隆或下载项目

将项目文件下载到您的 web 服务器目录中。

### 2. 创建数据库

使用 MySQL 客户端执行 `db.sql` 文件来创建数据库和基础表：

```bash
mysql -u root -p < db.sql
```

接着执行 `create_group_invitation_tables.sql` 文件来创建群聊邀请相关表：

```bash
mysql -u root -p < create_group_invitation_tables.sql
```
最后执行 `create_ip_registration_table.sql` 文件来创建群聊邀请相关表：

```bash
mysql -u root -p < create_ip_registration_table.sql
```
或者在 phpMyAdmin 中分别导入 `db.sql`、 `create_group_invitation_tables.sql` 和 `create_ip_registration_table.sql` 文件。

### 3. 配置数据库连接

编辑 `config.php` 文件，配置您的数据库连接信息：

```php
define('DB_HOST', 'localhost');
define('DB_NAME', 'chat');
define('DB_USER', 'root');
define('DB_PASS', 'your_password');
```

### 4. 配置文件上传

确保 `uploads/` 目录具有写入权限：

```bash
chmod 777 uploads/
```

### 5. 启动 web 服务器

使用 Apache 或 Nginx 启动您的 web 服务器，然后访问项目目录。

## 使用说明

### 1. 注册账户

访问 `register.php` 页面，填写用户名、邮箱和密码进行注册。
注：首次组成请注册一个Admin管理员账号，后续用户注册请使用普通用户名注册。

### 2. 登录系统

访问 `login.php` 页面，使用注册的邮箱和密码登录。

### 3. 添加好友

在聊天页面的搜索栏中输入好友的用户名，发送好友请求。

### 4. 开始聊天

在好友列表中选择一个好友，开始发送消息和文件。

### 5. 提交反馈

1. 在聊天页面点击右上角的三个点图标，选择"反馈问题"
2. 在弹出的反馈表单中输入您的问题描述
3. （可选）上传相关的图片
4. 点击"提交反馈"按钮

### 6. 管理反馈（管理员）

1. 登录管理员账户
2. 在管理页面点击"反馈管理"标签
3. 查看所有用户提交的反馈
4. 点击"反馈已收到"按钮标记反馈为已处理
5. （可选）点击"删除反馈"按钮删除反馈

### 7. 创建和使用群聊

1. 在聊天页面点击"建立群聊"按钮
2. 输入群聊名称
3. 选择要邀请的好友
4. 点击"创建群聊"按钮

### 8. 邀请好友加入群聊

1. 在群聊页面点击右上角的三个点图标
2. 选择"邀请好友"选项
3. 在弹出的好友列表中选择要邀请的好友
4. 点击"邀请"按钮发送邀请

### 9. 处理群聊邀请

- 当您收到群聊邀请时，系统会在右上角显示通知
- 点击"接受"按钮接受邀请，或者点击"拒绝"按钮拒绝邀请
- 如果邀请您的用户是管理员或群主，您会直接加入群聊
- 如果邀请您的用户不是管理员或群主，您的入群申请会发送给管理员或群主审批

### 10. 查看和处理入群申请（管理员/群主）

1. 作为管理员或群主，您会收到入群申请通知
2. 点击"批准"按钮批准申请，或者点击"拒绝"按钮拒绝申请
3. 被批准的用户会直接加入群聊
4. 被拒绝的用户不会加入群聊

### 11. 查看反馈通知

- 当您提交的反馈被管理员标记为已收到时，您下次登录系统会收到通知
- 通知会显示在聊天页面的右上角，点击关闭按钮即可关闭通知

### 12. 封禁用户（管理员）

1. 登录管理员账户
2. 在管理页面找到要封禁的用户
3. 点击"封禁用户"按钮
4. 填写封禁理由和封禁时长
5. 点击"确认封禁"按钮

被封禁用户将：
- 无法在登录页面登录
- 在线用户会收到封禁通知并在10秒后自动退出
- 显示明确的封禁原因和预计解封时间

### 13. 自动添加管理员好友

- 新用户注册后会自动添加名为"Admin"的管理员为好友，无需手动发送请求
- 已注册用户首次登录后会自动添加Admin为好友
- 双向好友关系自动建立，Admin和用户互为好友
- 方便管理员与用户沟通，便于管理和支持

### 14. 撤回消息和文件

#### 14.1 撤回自己发送的消息或文件

- 找到您想要撤回的消息或文件
- 点击消息右下角的菜单图标（三个点）
- 在弹出的菜单中选择"撤回"选项
- 确认撤回操作

#### 14.2 撤回后效果

- 撤回成功后，原消息位置会显示撤回提示："{时间}:您撤回了一条消息"
- 其他用户看到的提示："{时间}:{用户名}撤回了一条消息"
- 撤回的消息和文件将从数据库中删除
- 服务器上的对应文件也会被自动删除

#### 14.3 重新编辑消息

- 消息撤回后，您会看到"重新编辑"蓝色标签
- 点击"重新编辑"标签
- 原消息内容会自动填充到输入框中
- 您可以修改后重新发送

#### 14.4 撤回限制

- 只能撤回2分钟内发送的消息和文件
- 只能撤回自己发送的消息和文件
- 管理员和群主可以撤回群聊中其他成员的消息和文件
- 重新编辑功能仅在撤回后2分钟内可用

---

## 移动端使用说明

### 15. 访问移动端聊天页面

- 使用移动设备访问系统时，系统会自动跳转到移动端聊天页面
- 移动端聊天页面URL：`mobilechat.php`
- 桌面端也可以直接访问`mobilechat.php`查看移动端页面

### 16. 移动端好友管理

#### 16.1 查看好友申请

- 在移动端聊天页面点击右上角的用户头像或菜单按钮
- 在菜单中选择"好友申请"选项
- 查看所有收到的好友申请

#### 16.2 处理好友申请

- 在好友申请列表中，找到要处理的申请
- 点击"同意"按钮接受好友申请
- 点击"拒绝"按钮拒绝好友申请

### 17. 移动端聊天菜单

#### 17.1 好友聊天菜单

- 进入好友聊天页面
- 点击聊天页面右上角的三个点菜单按钮
- 点击"删除好友"选项删除当前好友

#### 17.2 群聊菜单

- 进入群聊页面
- 点击聊天页面右上角的三个点菜单按钮
- 点击"查看成员"选项查看群成员列表
- 点击"退出群聊"选项退出当前群聊

### 18. 移动端群成员操作

- 在群聊菜单中选择"查看成员"选项
- 找到要操作的群成员
- 点击成员后面的三个点菜单按钮
- 点击"发送好友申请"选项向该成员发送好友申请
- 确认发送申请

### 19. 移动端其他功能

- 移动端支持发送文本消息和文件
- 移动端支持查看好友在线状态
- 移动端支持搜索好友
- 移动端支持提交反馈
- 移动端支持扫码登录PC端
- 移动端支持消息撤回和重新编辑

---

## 安全说明

- 密码使用 PHP 内置的 `password_hash()` 函数进行哈希存储
- 使用 PDO 预处理语句防止 SQL 注入
- 文件上传经过严格的类型和大小验证
- 错误信息不包含敏感内容

## 浏览器支持

- Chrome (推荐)
- Firefox
- Safari
- Edge
- via
- 主流浏览器
## 许可证

MIT License
